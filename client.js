(()=>{"use strict";class t extends Event{integrityId;launchType;static integrityId;static async dispatch(i){t.integrityId=crypto.randomUUID();const o=new t(t.integrityId,i);if(!window.dispatchEvent(o))return;const d=await CryoFallModLoader.ModList.load(i);o.integrityId===t.integrityId&&(d.success?window.dispatchEvent(new e(t.integrityId,i,d.payload)):window.dispatchEvent(new n(t.integrityId,i,d.error)))}static on(t){window.addEventListener("cfml.mod-list.load",t)}static off(t){window.removeEventListener("cfml.mod-list.load",t)}constructor(t,e){super("cfml.mod-list.load"),this.integrityId=t,this.launchType=e}}class e extends Event{integrityId;launchType;payload;static on(t){window.addEventListener("cfml.mod-list.load.done",t)}static off(t){window.removeEventListener("cfml.mod-list.load.done",t)}constructor(t,e,n){super("cfml.mod-list.load.done"),this.integrityId=t,this.launchType=e,this.payload=n}}class n extends Event{integrityId;launchType;error;static on(t){window.addEventListener("cfml.mod-list.load.fail",t)}static off(t){window.removeEventListener("cfml.mod-list.load.fail",t)}constructor(t,e,n){super("cfml.mod-list.load.fail"),this.integrityId=t,this.launchType=e,this.error=n}}function i(t,e,n){const i=t.getElementById(e);if(!i)throw new Error(`element with id "#${e}" not found`);if("function"!=typeof n||i instanceof n)return i;throw new Error(`element type missmatch #${e}: expected ${n.name} got ${i.constructor.name}`)}const o=i(document,"view-switch-control-mods",HTMLInputElement);o.checked=!0;const d=i(document,"view-switch-control-config",HTMLInputElement),s=i(document,"view-switch-control-mod",HTMLInputElement);var c;function r(t){o.checked=t===c.modList,d.checked=t===c.config,s.checked=t===c.mod}!function(t){t.modList="mod-list",t.mod="mod",t.config="config"}(c||(c={}));class a extends Event{static dispatch(t){return window.dispatchEvent(new a(t))}static on(t){window.addEventListener("cfml:launch-type.change",t)}static off(t){window.removeEventListener("cfml:launch-type.change",t)}constructor(t){super("cfml:launch-type.change"),this.launchType=t}launchType}const l=i(document,"launch-type-client",HTMLInputElement);l.value=CryoFallModLoader.LaunchType.client,l.addEventListener("change",p),l.addEventListener("change",(()=>{a.dispatch(CryoFallModLoader.LaunchType.client)}));const u=i(document,"launch-type-server",HTMLInputElement);u.value=CryoFallModLoader.LaunchType.server,u.addEventListener("change",p),u.addEventListener("change",(()=>{a.dispatch(CryoFallModLoader.LaunchType.server)}));const m=i(document,"launch-type-editor",HTMLInputElement);m.value=CryoFallModLoader.LaunchType.editor,m.addEventListener("change",p),m.addEventListener("change",(()=>{a.dispatch(CryoFallModLoader.LaunchType.editor)}));const h=i(document,"_launch-type",HTMLInputElement);function p(){h.checked=!1}function y(){return u.checked?CryoFallModLoader.LaunchType.server:m.checked?CryoFallModLoader.LaunchType.editor:CryoFallModLoader.LaunchType.client}function f(t){return t.cloneNode(!0)}function w(t,e,n){const i=t.querySelector(e);if(!i)throw new Error(`element with selector "${e}" not found`);if("function"!=typeof n||i instanceof n)return i;throw new Error(`element type missmatch '${e}': expected ${n.name} got ${i.constructor.name}`)}const v=i(document,"notification-list"),L=i(document,"notification-entry-template",HTMLTemplateElement);function E(t){return{title:w(t,".title"),description:w(t,".description"),actions:{retry:w(t,".retry"),dismiss:w(t,".dismiss")}}}const g=new WeakMap;function T(t,e){const n="_"+crypto.randomUUID(),o=w(f(L.content),".notification-entry");o.id=n,o.classList.add(t);const d=E(o);d.description.textContent=e.description,d.title.textContent=e.title;const s={data:{retry:e.retry},actions:{dismiss(){!function(t){const e=i(document,t),n=g.get(e);if(!n)return;const o=E(e);o.actions.dismiss.removeEventListener("click",n.actions.dismiss),o.actions.retry.removeEventListener("click",n.actions.retry),g.delete(e),e.remove()}(n)},retry(){e.retry?.()}}};return g.set(o,s),d.actions.dismiss.addEventListener("click",s.actions.dismiss),d.actions.retry.addEventListener("click",s.actions.retry),d.actions.retry.hidden="function"!=typeof e.retry,v.append(o),n}const I=i(document,"config-view",HTMLFormElement),M=i(document,"config-client-dir-input",HTMLInputElement),b=i(document,"config-editor-dir-input",HTMLInputElement),C=i(document,"config-server-dir-input",HTMLInputElement);async function x(){const t=await CryoFallModLoader.Config.load();t.success||T("error",{title:"Failed load config",description:t.error}),M.value=t.payload?.clientDir??"",b.value=t.payload?.editorDir??"",C.value=t.payload?.serverDir??""}a.on(x),I.addEventListener("reset",(t=>{t.preventDefault(),x()})),I.addEventListener("submit",(t=>{t.preventDefault(),x()})),i(document,"view-switch-control-mods",HTMLInputElement).checked=!0,i(document,"view-switch-control-config",HTMLInputElement),i(document,"view-switch-control-mod",HTMLInputElement),i(document,"view-switch-icon-mods"),i(document,"view-switch-icon-config"),i(document,"mods-view"),i(document,"mod-list--error"),i(document,"mod-list--empty"),i(document,"upload-mod-dialog-open-button",HTMLButtonElement).addEventListener("click",(()=>{k.showModal()}));const k=i(document,"upload-mod-dialog",HTMLDialogElement);k.addEventListener("click",(t=>{const{target:e,currentTarget:n}=t;if(e!==n)return;const{top:i,left:o,bottom:d,right:s}=k.getBoundingClientRect(),{clientX:c,clientY:r}=t;i<=r&&r<=d&&o<=c&&c<=s||k.close()}));const H=i(document,"upload-mod-file-input",HTMLInputElement),F=i(document,"upload-mod-link-form",HTMLFormElement),D=i(document,"upload-mod-link-input",HTMLInputElement),U=(i(document,"mod-list"),i(document,"mod-entry-template",HTMLTemplateElement),i(document,"mod-search-input",HTMLInputElement),i(document,"config-view",HTMLFormElement),i(document,"config-client-dir-input",HTMLInputElement),i(document,"config-editor-dir-input",HTMLInputElement),i(document,"config-server-dir-input",HTMLInputElement),i(document,"drop-overlay-control",HTMLInputElement));class A extends Event{integrityId;launchType;modId;static integrityId;static async dispatch(t,e){A.integrityId=crypto.randomUUID();const n=new A(A.integrityId,t,e);if(!window.dispatchEvent(n))return;const i=await CryoFallModLoader.ModList.delete(t,e);n.integrityId===A.integrityId&&(i.success?window.dispatchEvent(new S(A.integrityId,t,e)):window.dispatchEvent(new $(A.integrityId,t,e,i.error)))}static on(t){window.addEventListener("cfml.mod-list.delete",t)}static off(t){window.removeEventListener("cfml.mod-list.delete",t)}constructor(t,e,n){super("cfml.mod-list.delete"),this.integrityId=t,this.launchType=e,this.modId=n}}class S extends Event{integrityId;launchType;modId;static on(t){window.addEventListener("cfml.mod-list.delete.done",t)}static off(t){window.removeEventListener("cfml.mod-list.delete.done",t)}constructor(t,e,n){super("cfml.mod-list.delete.done"),this.integrityId=t,this.launchType=e,this.modId=n}}class $ extends Event{integrityId;launchType;modId;error;static on(t){window.addEventListener("cfml.mod-list.delete.fail",t)}static off(t){window.removeEventListener("cfml.mod-list.delete.fail",t)}constructor(t,e,n,i){super("cfml.mod-list.delete.fail"),this.integrityId=t,this.launchType=e,this.modId=n,this.error=i}}class B extends Event{integrityId;launchType;modId;static integrityId;static async dispatch(t,e){B.integrityId=crypto.randomUUID();const n=new B(B.integrityId,t,e);if(!window.dispatchEvent(n))return;const i=await CryoFallModLoader.ModList.disable(t,e);n.integrityId===B.integrityId&&(i.success?window.dispatchEvent(new N(B.integrityId,t,e)):window.dispatchEvent(new q(B.integrityId,t,e,i.error)))}static on(t){window.addEventListener("cfml.mod-list.disable",t)}static off(t){window.removeEventListener("cfml.mod-list.disable",t)}constructor(t,e,n){super("cfml.mod-list.disable"),this.integrityId=t,this.launchType=e,this.modId=n}}class N extends Event{integrityId;launchType;modId;static on(t){window.addEventListener("cfml.mod-list.disable.done",t)}static off(t){window.removeEventListener("cfml.mod-list.disable.done",t)}constructor(t,e,n){super("cfml.mod-list.disable.done"),this.integrityId=t,this.launchType=e,this.modId=n}}class q extends Event{integrityId;launchType;modId;error;static on(t){window.addEventListener("cfml.mod-list.disable.fail",t)}static off(t){window.removeEventListener("cfml.mod-list.disable.fail",t)}constructor(t,e,n,i){super("cfml.mod-list.disable.fail"),this.integrityId=t,this.launchType=e,this.modId=n,this.error=i}}class K extends Event{integrityId;launchType;modId;static integrityId;static async dispatch(t,e){K.integrityId=crypto.randomUUID();const n=new K(K.integrityId,t,e);if(!window.dispatchEvent(n))return;const i=await CryoFallModLoader.ModList.enable(t,e);n.integrityId===K.integrityId&&(i.success?window.dispatchEvent(new P(K.integrityId,t,e)):window.dispatchEvent(new W(K.integrityId,t,e,i.error)))}static on(t){window.addEventListener("cfml.mod-list.enable",t)}static off(t){window.removeEventListener("cfml.mod-list.enable",t)}constructor(t,e,n){super("cfml.mod-list.enable"),this.integrityId=t,this.launchType=e,this.modId=n}}class P extends Event{integrityId;launchType;modId;static on(t){window.addEventListener("cfml.mod-list.enable.done",t)}static off(t){window.removeEventListener("cfml.mod-list.enable.done",t)}constructor(t,e,n){super("cfml.mod-list.enable.done"),this.integrityId=t,this.launchType=e,this.modId=n}}class W extends Event{integrityId;launchType;modId;error;static on(t){window.addEventListener("cfml.mod-list.enable.fail",t)}static off(t){window.removeEventListener("cfml.mod-list.enable.fail",t)}constructor(t,e,n,i){super("cfml.mod-list.enable.fail"),this.integrityId=t,this.launchType=e,this.modId=n,this.error=i}}const _=i(document,"mod-view"),R=w(_,".author"),X=w(_,".title"),Y=w(_,".description"),j=w(_,".version"),z=w(_,".button[data-action=deleteMod]",HTMLButtonElement),G={control:w(_,".status-switch.control",HTMLInputElement),button:w(_,".status-switch.button",HTMLLabelElement),titleEnabled:w(_,".status-switch.title.enabled"),titleDisabled:w(_,".status-switch.title.disabled")};async function J(){S.on((t=>{_.getAttribute("data-mod-id")===t.modId&&r(c.modList)}))}G.control.id="_"+crypto.randomUUID(),G.button.setAttribute("for",G.control.id),z.addEventListener("click",(()=>{const t=_.getAttribute("data-mod-id");t&&A.dispatch(y(),t)})),G.control.addEventListener("change",(()=>{const t=_.getAttribute("data-mod-id");t&&(G.control.checked?K.dispatch(y(),t):B.dispatch(y(),t))}));const O=i(document,"mod-list"),Q=i(document,"mod-list--error"),V=i(document,"mod-entry-template",HTMLTemplateElement),Z=i(document,"mod-search-input",HTMLInputElement);function tt(t,e){y()===t&&(Q.textContent=e||null)}const et=function(t,e){let n=-1;function i(...e){~n||window.clearTimeout(n),n=window.setTimeout(((...e)=>{t(...e),n=-1}),1e3,...e)}return i.cancel=()=>{~n||(window.clearTimeout(n),n=-1)},i.runNow=(...e)=>{~n||window.clearTimeout(n),t(...e),n=-1},i}(ot);function nt(t){return{header:w(t,".header"),title:w(t,".title"),author:w(t,".author"),version:w(t,".version"),description:w(t,".description"),deleteMod:w(t,".button[data-action=deleteMod]",HTMLButtonElement),statusSwitch:{control:w(t,".status-switch.control",HTMLInputElement),button:w(t,".status-switch.button",HTMLLabelElement),titleEnabled:w(t,".status-switch.title.enabled"),titleDisabled:w(t,".status-switch.title.disabled")}}}function it(t,e){if(y()===t){for(e.every(((e,n)=>{const i=function(t,e){if(y()!==t)return;let n=O.querySelector(`.mod-entry[data-mod-id=${e.id}]`);n||(n=function(t,e){const n=w(f(V.content),".mod-entry");n.setAttribute("data-mod-id",e.id);const i=nt(n);return i.header.addEventListener("click",(()=>{!function(t){const e=w(document,`.mod-entry[data-mod-id=${t}]`),n=w(e,".author"),i=w(e,".title"),o=w(e,".description"),d=w(e,".version"),s={control:w(e,".status-switch.control",HTMLInputElement)};_.setAttribute("data-mod-id",t),R.textContent=n.textContent,X.textContent=i.textContent,Y.textContent=o.textContent,j.textContent=d.textContent,G.control.checked=s.control.checked,G.control.value=t}(e.id)})),i.statusSwitch.control.id="mod-entry-status-switch--"+e.id,i.statusSwitch.button.setAttribute("for",i.statusSwitch.control.id),i.deleteMod.addEventListener("click",(async()=>{n.classList.contains("suspend")||(n.classList.add("suspend"),await A.dispatch(t,e.id),n.classList.remove("suspend"))})),i.statusSwitch.control.addEventListener("change",(async()=>{n.classList.contains("suspend")||(n.classList.add("suspend"),i.statusSwitch.control.checked?await K.dispatch(t,e.id):await B.dispatch(t,e.id),n.classList.remove("suspend"))})),n}(t,e));const i=nt(n);return i.statusSwitch.control.checked=e.enabled,i.title.innerText!==e.title&&(i.title.innerText=e.title),i.author.innerText!==e.author&&(i.author.innerText=e.author),i.version.innerText!==e.version&&(i.version.innerText=e.version),i.description.innerText!==e.description&&(i.description.innerText=e.description),n}(t,e);return!!i&&(O.childNodes.item(n)!==i&&O.insertBefore(i,O.childNodes.item(n)),!0)}));e.length<O.childNodes.length;)O.childNodes.item(e.length)?.remove();ot()}}function ot(){const t=Z.value;t.length<3?O.querySelectorAll(".mod-entry").forEach((t=>{t.classList.remove("hidden")})):O.querySelectorAll(".mod-entry").forEach((e=>{const n=w(e,".title").textContent;let i=n?.includes(t)??!1;if(!i){const n=w(e,".description").textContent?.toLowerCase();i=n?.includes(t)??!1}if(!i){const n=w(e,".author").textContent?.toLowerCase();i=n?.includes(t)??!1}e.classList.toggle("hidden",!i)}))}async function dt(){a.on((e=>{t.dispatch(e.launchType)})),t.on(et.cancel),e.on((t=>{it(t.launchType,t.payload),tt(t.launchType,null)})),n.on((t=>{it(t.launchType,[]),tt(t.launchType,t.error)})),A.on(et.cancel),S.on((e=>{t.dispatch(e.launchType)})),$.on((e=>{T("error",{title:"Delete failed",description:e.error}),t.dispatch(e.launchType)})),K.on(et.cancel),P.on((e=>{t.dispatch(e.launchType)})),W.on((e=>{T("error",{title:"Enable failed",description:e.error}),t.dispatch(e.launchType)})),B.on(et.cancel),N.on((e=>{t.dispatch(e.launchType)})),q.on((e=>{T("error",{title:"Disable failed",description:e.error}),t.dispatch(e.launchType)})),await t.dispatch(y())}async function st(t){const e=await t.arrayBuffer();return await CryoFallModLoader.Mod.saveFromFile(y(),new Int8Array(e))}Z.addEventListener("input",(()=>{O.childElementCount<100?et.runNow():et()})),window.addEventListener("dragenter",(t=>{k.open||t.dataTransfer?.types?.includes("Files")&&(U.checked=!0,t.preventDefault())})),window.addEventListener("dragover",(t=>{k.open||t.dataTransfer?.types?.includes("Files")&&(U.checked=!0,t.preventDefault())})),window.addEventListener("dragleave",(t=>{k.open||t.relatedTarget||(U.checked=!1,t.preventDefault())})),window.addEventListener("drop",(async e=>{if(k.open)return;U.checked=!1,e.preventDefault();const n=[...e.dataTransfer?.files||[]].filter((t=>t.name.endsWith(".mpk"))).map(st);(await Promise.all(n)).forEach((t=>{t.success||console.error(t.error)})),t.dispatch(y())}));const ct=(rt=ClipboardEvent,t=>t instanceof rt);var rt;window.addEventListener("paste",(async e=>{if(!ct(e))return;if(k.open)return;const n=e.clipboardData?.getData("text/plain")??"",i=[];/^(https?:)?\/\//.test(n)&&i.push(CryoFallModLoader.Mod.saveFromUrl(y(),n)),[...e.clipboardData?.files||[]].filter((t=>t.name.endsWith(".mpk"))).forEach((t=>{i.push(st(t))})),(await Promise.all(i)).forEach((t=>{t.success||console.error(t.error)})),t.dispatch(y())})),F.addEventListener("submit",(async e=>{e.preventDefault();const n=await CryoFallModLoader.Mod.saveFromUrl(y(),D.value);n.success?(t.dispatch(y()),D.value="",k.close()):console.error(n.error)})),D.addEventListener("keydown",(t=>{t.ctrlKey||t.altKey||t.shiftKey||t.metaKey||"Escape"!==t.key||(t.preventDefault(),D.value="")})),H.addEventListener("change",(async()=>{const e=(n=H.files)?Array.from(n).filter((t=>t.name.endsWith(".mpk"))).map((async t=>CryoFallModLoader.Mod.saveFromFile(y(),new Int8Array(await t.arrayBuffer())))):[];var n;(await Promise.all(e)).forEach((t=>{t.success||console.error(t.error)})),t.dispatch(y()),H.value=null,k.close()})),async function(){var t;await Promise.all([x(),dt(),J()]),r(c.modList),t=CryoFallModLoader.LaunchType.client,l.checked=t===CryoFallModLoader.LaunchType.client,u.checked=t===CryoFallModLoader.LaunchType.server,m.checked=t===CryoFallModLoader.LaunchType.editor,a.dispatch(t)}()})();
//# sourceMappingURL=client.js.map